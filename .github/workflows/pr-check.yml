name: PR Check

on:
  pull_request:
    branches:
      - main

jobs:
  check-dev-deployment:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Dev Workflow Status
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            
            // Get latest dev workflow run
            const { data: runs } = await github.rest.actions.listWorkflowRuns({
              owner,
              repo,
              workflow_id: 'dev.yml',
              branch: 'dev',
              per_page: 1
            });
            
            if (runs.workflow_runs.length === 0) {
              core.setFailed('No dev deployment found. Deploy to dev branch first.');
              return;
            }
            
            const latestRun = runs.workflow_runs[0];
            
            if (latestRun.conclusion !== 'success') {
              core.setFailed(`Dev deployment failed. Status: ${latestRun.conclusion}. Fix dev branch first.`);
              return;
            }
            
            console.log('âœ“ Dev deployment successful. PR can proceed.');